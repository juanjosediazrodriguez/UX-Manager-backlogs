{% extends "base.html" %}
{% block title %}Inicio - UX Manager{% endblock %}
{% block content %}
  <section aria-labelledby="home-overview" class="space-y-10">
    <header class="space-y-3">
      <h1 id="home-overview" class="text-3xl font-semibold text-brand-700">Gestiona la experiencia del equipo</h1>
      <p class="text-neutral-700 max-w-3xl">Centraliza las resenas de candidatos y colaboradores, detecta tendencias a simple vista y prepara tu siguiente iteracion con datos claros. Empieza buscando una empresa y revisa su pulso de satisfaccion.</p>
    </header>

    <section id="buscador" aria-labelledby="search-heading" class="space-y-6">
      <div class="rounded-xl border bg-white p-6 shadow-sm space-y-6">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <h2 id="search-heading" class="text-xl font-semibold text-neutral-900">Busca una empresa</h2>
            <p class="text-sm text-neutral-600">Explora {{ total_companies }} perfiles con datos sinteticos de experiencia y talento.</p>
          </div>
          <p class="text-xs uppercase tracking-wide text-neutral-500">Mock de investigacion</p>
        </div>
        <form method="get" class="flex flex-col gap-4 lg:flex-row lg:items-center">
          <label for="query" class="sr-only">Nombre o sector</label>
          <input id="query" name="q" value="{{ query }}" placeholder="Ej. Nimbus Studio o salud" class="w-full rounded-lg border border-neutral-300 px-4 py-3 text-sm text-neutral-900 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-200" />
          <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-lg bg-brand-600 px-5 py-3 text-sm font-medium text-white shadow hover:bg-brand-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-500">Buscar</button>
          {% if has_query %}
            <a href="/" class="text-sm font-medium text-brand-600 hover:underline">Limpiar</a>
          {% endif %}
        </form>

        {% if has_query %}
          {% if search_results %}
            <div class="space-y-4" aria-live="polite">
              <p class="text-sm text-neutral-600">{{ result_count }} resultados para "{{ query }}". Mostramos los primeros {{ search_results|length }}.</p>
              <ul class="grid gap-4 md:grid-cols-2">
                {% for company in search_results %}
                  <li class="rounded-lg border border-neutral-200 bg-neutral-50 p-4 hover:border-brand-400 transition" aria-label="{{ company.name }}">
                    <div class="flex items-start justify-between gap-3">
                      <div>
                        <p class="text-sm font-semibold text-neutral-900">{{ company.name }}</p>
                        <p class="text-xs text-neutral-500">{{ company.industry }}  |  {{ company.location }}</p>
                      </div>
                      <span class="rounded-full bg-brand-100 px-3 py-1 text-xs font-medium text-brand-700">{{ company.avg_rating|floatformat:1 }} / 5</span>
                    </div>
                    <p class="mt-3 text-sm text-neutral-700">{{ company.highlight }}</p>
                    <div class="mt-3 flex flex-wrap gap-2 text-xs text-neutral-500">
                      {% for tag in company.tags %}
                        <span class="rounded-full bg-white px-2 py-1 border border-neutral-200">#{{ tag }}</span>
                      {% endfor %}
                    </div>
                    <a href="{% url 'calificaciones' company.slug %}" class="mt-4 inline-flex items-center gap-2 text-sm font-medium text-brand-700 hover:underline">Ver calificaciones -></a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% else %}
            <div class="rounded-lg border border-dashed border-neutral-300 bg-neutral-50 p-6 text-sm text-neutral-600">
              <p>No encontramos coincidencias para "{{ query }}". Intenta con otro nombre, sector o ubicacion.</p>
            </div>
          {% endif %}
        {% else %}
          <p class="text-sm text-neutral-600">Escribe el nombre, la industria o la ubicacion para ver resultados personalizados.</p>
        {% endif %}

        <div id="destacados" class="space-y-3" aria-live="polite">
          <p class="text-sm text-neutral-600">{% if has_query %}Tambien revisa estas empresas destacadas por satisfaccion promedio.{% else %}Empresas destacadas por satisfaccion promedio.{% endif %}</p>
          <div class="grid gap-4 md:grid-cols-3">
            {% for company in top_companies %}
              <article class="rounded-lg border border-neutral-200 bg-neutral-50 p-4">
                <h3 class="text-sm font-semibold text-neutral-900">{{ company.name }}</h3>
                <p class="text-xs text-neutral-500">{{ company.industry }}  |  {{ company.location }}</p>
                <p class="mt-2 text-sm text-neutral-700">{{ company.summary_line }}</p>
                <div class="mt-3 flex items-center justify-between text-xs text-neutral-500">
                  <span class="font-medium text-brand-700">{{ company.avg_rating|floatformat:1 }} / 5</span>
                  <span>{{ company.review_count }} resenas</span>
                </div>
                <a href="{% url 'calificaciones' company.slug %}" class="mt-3 inline-flex items-center gap-2 text-sm font-medium text-brand-700 hover:underline">Ver calificaciones -></a>
              </article>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>
  </section>
{% endblock %}
